name: âš¡ Mediatek Uboot

on:
  workflow_dispatch:

jobs:
  build:
    name: Build ${{ matrix.device }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      max-parallel: 15
      matrix:
        device:
          - mt7981-360t7
          - mt7981-abt_asr3000
          - mt7981-ax3000t
          - mt7981-ax3000t_an8855
          - mt7981-cetron_ct3003
          - mt7981-cmcc_a10
          - mt7981-cmcc_rax3000m
          - mt7981-cmcc_rax3000m-emmc
          - mt7981-cudy_tr3000-v1
          - mt7981-h3c_magic-nx30-pro
          - mt7981-imou_lc-hx3001
          - mt7981-jcg_q30
          - mt7981-konka_komi-a31
          - mt7981-livinet_zr-3020
          - mt7981-nokia_ea0326gmp
          - mt7981-wr30u
          - mt7986-jdcloud_re-cp-03
          - mt7986-netcore_n60
          - mt7986-netcore_n60-pro
          - mt7986-netcore_n60-pro-512rom
          - mt7986-redmi_ax6000
          - mt7986-tplink_tl-xdr608x
          - mt7986-tplink_tl-xtr8488

    steps:
      - name: Install dependencies
        env:
          DEBIAN_FRONTEND: noninteractive
        run: |
          sudo -E apt-get update
          sudo -E apt-get install gcc-aarch64-linux-gnu build-essential flex bison libssl-dev device-tree-compiler jq
          
      - name: Checkout source tree
        uses: actions/checkout@v4
        with:
          repository: NeonPulse-Zero/bl-mt798x   # âœ… æŒ‡å®šæºç ä»“åº“
          fetch-depth: 0
          
      - name: Build BL2 and FIP
        env:
          CONFIG: ${{ matrix.device }}
        run: |
          export SOC="${CONFIG%%-*}"
          BOARD="${CONFIG#*-}"
          export BOARD="$BOARD"
          mkdir -p "output"
          ./build.sh
          echo "ARTIFACT_NAME=$SOC-$BOARD" >> "$GITHUB_ENV"
          
      - name: Upload build outputs
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.ARTIFACT_NAME }}
          path: output/*

      - name: Upload firmware to release
        uses: ncipollo/release-action@v1
        with:
          name: MT798X_Uboot
          allowUpdates: true
          tag: MT798X_Uboot
          token: ${{ secrets.GITHUB_TOKEN }}
          artifacts: output/*
          body: |
            # ğŸ› ï¸ mt798x uboot åŠŸèƒ½ä»‹ç»

            **æ—¥æœŸ**ï¼šSep 09, 2025  
            **é¡¹ç›®**ï¼šbl-mt798x é¡¹ç›®åŸºäº mtk åŸå‚æä¾›çš„ ATF åŠ uboot æºç ï¼Œç‰¹ç‚¹å¦‚ä¸‹  

            ## âœ¨ ç‰¹ç‚¹

            - ğŸ› ï¸ uboot è‡ªå¸¦ mtk åŸå‚å¼€å‘çš„ç®€æ˜“ webui æ¢å¤ç•Œé¢ï¼Œå¯ä»¥é€šè¿‡ webui ç›´æ¥åˆ·å…¥å›ºä»¶æˆ–è€…æ›´æ–° ubootï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸²å£ + TFTP åˆ·å…¥å›ºä»¶  

            - ğŸ› ï¸ æ”¯æŒ GL.iNet å¼€å‘çš„é€šç”µåé•¿æŒ‰ RESET æŒ‰é’®è‡ªåŠ¨è¿›å…¥ webui æ¢å¤ç•Œé¢çš„åŠŸèƒ½  

            - ğŸ› ï¸ æ”¯æŒå¤šç§ Flash åˆ†åŒºå¸ƒå±€åˆ‡æ¢åŠŸèƒ½ï¼ˆä»…æ”¯æŒ spi-nandï¼‰ï¼Œå¯ä»¥åœ¨ webui ä¸­åˆ‡æ¢ä¸åŒçš„åˆ†åŒºå¸ƒå±€ï¼Œå®Œç¾å…¼å®¹å°ç±³åŸå‚å›ºä»¶  

            - ğŸ› ï¸ åŠ å…¥å®Œæ•´çš„ä¸­æ–‡æ±‰åŒ–ç•Œé¢ï¼Œä¸ä»…èœå•å’Œæç¤ºä¿¡æ¯å‡å·²æœ¬åœ°åŒ–ï¼Œè¿˜ä¼˜åŒ–äº†äº¤äº’ä½“éªŒï¼Œæ–¹ä¾¿å›½å†…ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨
